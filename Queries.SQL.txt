- SQL SALES ANALYSIS PROJECT
-- Author: Akshat Mandhaniya
-- Description: Sales and customer analysis using SQL

- 1. View all customers
SELECT * FROM customers;

-- 2. View all products
SELECT * FROM products;

-- 3. View all orders
SELECT * FROM orders;

-- 4. List customers from Delhi
SELECT *
FROM customers
WHERE city = 'Delhi';

-- 5. List products priced above 5000
SELECT *
FROM products
WHERE price > 5000;

-- 6. Show all orders with customer names
SELECT o.order_id, c.customer_name, o.order_date
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id;

-- 7. Show all orders with product names
SELECT o.order_id, p.product_name, o.quantity
FROM orders o
JOIN products p ON o.product_id = p.product_id;

-- 8. Show customer name, product name, and order date
SELECT c.customer_name, p.product_name, o.order_date
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id;

-- 9. Show total quantity ordered per product
SELECT p.product_name, SUM(o.quantity) AS total_quantity
FROM orders o
JOIN products p ON o.product_id = p.product_id
GROUP BY p.product_name;

-- 10. Show total orders placed by each customer
SELECT c.customer_name, COUNT(o.order_id) AS total_orders
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
GROUP BY c.customer_name;

11. Calculate total revenue per product
SELECT p.product_name,
       SUM(o.quantity * p.price) AS total_revenue
FROM orders o
JOIN products p ON o.product_id = p.product_id
GROUP BY p.product_name;

-- 12. Calculate total revenue per customer
SELECT c.customer_name,
       SUM(o.quantity * p.price) AS total_spent
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id
GROUP BY c.customer_name;

-- 13. Find the most expensive product
SELECT product_name, price
FROM products
ORDER BY price DESC
LIMIT 1;

-- 14. Find average product price by category
SELECT category, AVG(price) AS avg_price
FROM products
GROUP BY category;

-- 15. Find customers who placed more than 2 orders
SELECT c.customer_name, COUNT(o.order_id) AS order_count
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
GROUP BY c.customer_name
HAVING COUNT(o.order_id) > 2;

16. Find products with price higher than average price
SELECT product_name, price
FROM products
WHERE price > (SELECT AVG(price) FROM products);

-- 17. Find customers who ordered a Laptop
SELECT DISTINCT c.customer_name
FROM orders o
JOIN customers c ON o.customer_id = c.customer_id
JOIN products p ON o.product_id = p.product_id
WHERE p.product_name = 'Laptop';

-- 18. Rank products based on total revenue
SELECT product_name,
       total_revenue,
       RANK() OVER (ORDER BY total_revenue DESC) AS revenue_rank
FROM (
    SELECT p.product_name,
           SUM(o.quantity * p.price) AS total_revenue
    FROM orders o
    JOIN products p ON o.product_id = p.product_id
    GROUP BY p.product_name
) t;

-- 19. Find monthly order count
SELECT MONTH(order_date) AS order_month,
       COUNT(order_id) AS total_orders
FROM orders
GROUP BY MONTH(order_date)
ORDER BY order_month;

-- 20. Find top 3 customers by total spending
SELECT customer_name, total_spent
FROM (
    SELECT c.customer_name,
           SUM(o.quantity * p.price) AS total_spent
    FROM orders o
    JOIN customers c ON o.customer_id = c.customer_id
    JOIN products p ON o.product_id = p.product_id
    GROUP BY c.customer_name) t
ORDER BY total_spent DESC
LIMIT 3;